# 概念的には
RDBMSであるPostgreSQLでのクエリを直打ちする必要なく、抽象化した状態でNestJSから利用できるようにしてくれる。オブジェクト指向的にというが、元々のクエリ直打ちは手続き的と言えるのだろうか。元々オブジェクト指向がよくわからないのでわからない。

こういう働きをする概念/ものを**ORM(Object-Relational Mapping/Mapper)**と呼ぶようだ。功罪どちらもあるようだが特に罪の方はよくわかっていない。DB担当のエンジニアがPrismaをいじれるのならバックエンドエンジニアが楽をできそうなものだが。

# 今回のプロジェクトで触った部分
## スキーマ作成
まずschema.prismaを編集してどのようなモデルを作成するか指定する。多分ここが一番RDBMSに近い部分で、@uniqueや@idなどの修飾子があるようだ。主キー制約などはこれで付加するのだろう。
モデルにはカラム名と型があるので、CREATE TABLEでやるようなテーブルの定義と思ってよさそうだ。

## スキーマからコード生成？
さらにここから`npx prisma generate`を実行し、このスキーマの内容からクライアント？　を生成するらしい。出力先で一度事故ったが、結局`node_modules/`内に作成している。スキーマの内容からRDBMSに正しく出力できるコードを動的に生成しているのだろう。たしかにそうでないとコードが莫大になりそうだ。

~~そして多分このタイミングで`/backend/src/user/`が生成された。(試してみたときはmodel Userだったため？)ここにはuser.module.tsなどがあり、おそらくNestJSがこういうモジュールを寄せ集めてサーバを機能させるようにできていて、その一機能を自動生成したのではないかと思う。~~
ここには`dto/`(DTO->Data Transfer Object)というよくわからんものがあり、ここのクラスにname, emailを持たせないと実行時エラーが出た。自動採番(スキーマでは`autoincrement()`?)のIDはここには書かないらしい。

`/backend/src/user/`はNestJS CLIでCRUDひな形を作った際に生成されたもの。

## バックエンドへのデータ提供
`PrismaService`なるものを`UserService`のメンバとして持ち、this.prisma.user.create()などで呼び出せるようになっている。
たぶん、スキーマから生成したコードの方ですでにcreateやfindXxxといった関数を実装してあり、それを呼び出すだけで済むようになっているのだろう。
たしかにここまでRDBMSに送るクエリ文などは全く考えずに済むようになっている。

